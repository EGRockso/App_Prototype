/* =====================================================================
   ROCKSO — Mobile prototype (light theme)
   Version clean & rationalisée
   ---------------------------------------------------------------------
   • Palette + variables
   • Gabarit device (viewport, téléphone, notch, motifs)
   • Header, contenu défilant
   • Hero, sections, cartes, métriques
   • Chips (version unique)
   • Activity card + liste Journal
   • Gauge & Avatar
   • Tabbar iOS (frosted)
   • Micro-interactions
   • Backdrop hors téléphone (thème rockso)
   • Pages Sync (watch svg, progress, pulsar)
   • Barres & échelles
   • Training tabs (4 onglets sur 1 ligne)
   • Media queries
   ===================================================================== */

/* -------------------- Variables -------------------- */
:root{
  /* Palette Rockso */
  --rockso-green:  #3F8C6A;     /* vert texte/bouton */
  --rockso-beige:  #F5EFE3;     /* fond device */
  --rockso-cream:  #FFFBF4;     /* cartes */
  --rockso-line:   #E7DECF;     /* séparateurs */

  --rockso-pink:   #EB6E9A;     /* rose thème */
  --rockso-orange: #F2A65A;
  --rockso-yellow: #F2C14E;

  /* Couleurs UI */
  --bg:       #F1ECE1;          /* fond page derrière le device */
  --surface:  var(--rockso-beige);
  --surface-2:var(--rockso-cream);
  --text:     #2E6E55;          /* texte principal */
  --muted:    #6C8E7E;          /* texte secondaire */
  --line:     var(--rockso-line);
  --brand:    var(--rockso-green);
  --brand-2:  #72A88A;
  --danger:   #C65353;

  /* Rythme & effets */
  --radius:   22px;
  --shadow:   0 10px 24px rgba(160,140,120,.20);
  --tabbar-h: 68px;             /* hauteur dock iOS-like */
}

/* -------------------- Base -------------------- */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  font: 16px/1.45 "Manrope", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  color:var(--text);
  background: var(--bg);
}

/* -------------------- Viewport + Device -------------------- */
.viewport{
  min-height:100%;
  display:grid; place-items:center;
  padding:28px 12px;
}

.device{
  width: 394px; max-width: 100%;
  height: 844px; max-height: calc(100vh - 24px);
  background: var(--surface);
  border-radius: 42px;
  overflow:hidden;
  border:1px solid var(--line);
  box-shadow: var(--shadow);
  display:flex; flex-direction:column;
  position:relative;
}

/* Motifs Rockso */
.device::after{
  content:""; position:absolute; inset:0; pointer-events:none; opacity:.20;
  background:
    linear-gradient(135deg, rgba(235,110,154,.25) 0 140px, transparent 140px),
    radial-gradient(240px 240px at 60% 115%, rgba(242,193,78,.15) 0 60%, transparent 60%),
    radial-gradient(4px 4px at 10% 40%, rgba(63,140,106,.35) 98%, transparent 99%),
    radial-gradient(4px 4px at 16% 44%, rgba(242,166,90,.35) 98%, transparent 99%),
    radial-gradient(4px 4px at 86% 22%, rgba(63,140,106,.35) 98%, transparent 99%);
}

/* Notch */
.device::before{
  content:"";
  position:absolute; left:50%; transform:translateX(-50%);
  top:0; width: 180px; height: 28px; background:#eae2d6;
  border-bottom-left-radius:18px; border-bottom-right-radius:18px;
  z-index:5; box-shadow: 0 2px 0 rgba(255,255,255,.35) inset;
}

/* -------------------- Header -------------------- */
.app-header{
  height:64px; display:flex; align-items:center; justify-content:space-between;
  padding: 0 18px; border-bottom:1px solid var(--line);
  background:linear-gradient(180deg,#FFFDF8,#F6F0E6);
}
.brand{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px; color:var(--text); }
.brand-mark{ width:22px; height:22px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.15));}
.brand-name{ font-weight:700; }
.icon-btn{ background:none; border:none; color:var(--muted); padding:6px; border-radius:12px; }
.icon-btn:hover{ background:rgba(255,255,255,.6); color:var(--text); }

/* -------------------- Contenu défilant -------------------- */
.content.scroll{
  flex:1; overflow:auto;
  padding: 14px 14px calc(40px + var(--tabbar-h));
}

/* -------------------- Hero -------------------- */
.hero{ position:relative; overflow:hidden; border-radius: var(--radius); height:176px; }
.hero-img{
  width:100%; height:176px; object-fit:cover; display:block;
  filter: saturate(.98) contrast(1.02) brightness(.98);
}
.hero-overlay{
  position:absolute; inset:0;
  display:flex; flex-direction:column; justify-content:flex-end;
  padding: 18px 16px 28px;
  background: linear-gradient(180deg,
    rgba(245,239,227,0) 48%,
    rgba(245,239,227,.72) 82%,
    rgba(245,239,227,.94) 100%);
}
.tagline{
  margin:0;
  font-size:22px; font-weight:800; line-height:1.1; letter-spacing:.2px;
  color:var(--text);
  text-shadow: 0 1px 0 rgba(255,255,255,.30);
}

/* -------------------- Sections & cartes génériques -------------------- */
.section{ margin:16px 0 10px; }
.section-title{
  font-size:14px; text-transform:uppercase; letter-spacing:.12em; color:var(--text);
  opacity:.9; margin:0 0 8px;
}

.card{
  background:var(--surface-2);
  border:1px solid var(--line);
  border-radius:16px; padding:12px;
  box-shadow: 0 6px 16px rgba(0,0,0,.06);
}
.muted{ color:var(--muted); }

/* -------------------- Quick stats -------------------- */
.quick-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:8px; margin:12px 0 4px; }
.quick-card{
  background:var(--surface-2); padding:8px 10px; border-radius:14px;
  border:1px solid var(--line); box-shadow: 0 4px 12px rgba(0,0,0,.05);
}
.qc-label{ color:var(--muted); font-size:11px }
.qc-value{ font-size:16px; margin-top:2px; display:block; color:#1c3b2f }

/* Quick card “Évolution” */
.qc-evol{ padding-top: 6px; padding-bottom: 6px; }
.evol-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:4px 0; }
.evol-left{ display:flex; align-items:center; gap:8px; }
.evol-label{ color: var(--muted); font-size:11px; }
.evol-val{ font-size:15px; }

/* Pastilles statut */
.dot{ width:8px; height:8px; border-radius:50%; display:inline-block; box-shadow:0 0 0 4px rgba(242,231,210,.6); }
.dot--ok{   background: var(--brand); }
.dot--warn{ background: var(--rockso-yellow); }
.dot--risk{ background: var(--danger); }

/* -------------------- Chips (version unique) -------------------- */
.chips{
  display:flex; flex-wrap:nowrap; gap:8px;
  overflow-x:auto; overflow-y:visible;
  padding:2px 2px 4px; white-space:nowrap;
  scroll-snap-type:x proximity; -webkit-overflow-scrolling:touch;
  mask-image: linear-gradient(to right,
      transparent 0, black 16px,
      black calc(100% - 16px), transparent 100%);
}
.chips::-webkit-scrollbar{ display:none; }

.chip{
  flex:0 0 auto;
  display:inline-flex; align-items:center; gap:4px;
  padding:6px 8px;
  border-radius:999px; border:1px solid var(--line);
  background:#FFFDF8; color:var(--text);
  font-size:13px; line-height:1.1;
  scroll-snap-align:start;
}
.chip svg{ width:16px; height:16px; margin:0 1px; }
.chip .dot{ width:10px; height:10px; box-shadow:0 0 0 4px rgba(242,231,210,.6); }

/* -------------------- Activity card & métriques -------------------- */
.activity-card{
  display:block; background: var(--surface-2);
  border:1px solid var(--line); border-radius:16px; padding:12px;
  text-decoration:none; color:inherit; box-shadow:0 8px 20px rgba(0,0,0,.08);
}
.activity-card:hover{ border-color:#e9decd; transform: translateY(-1px); transition: .15s ease; }

.ac-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; color:var(--muted); }
.ac-head.big{ margin-top:8px; font-size:14px; }
.badge{
  display:inline-flex; align-items:center; gap:6px; font-weight:600;
  background: rgba(63,140,106,.12); color:#1c3b2f;
  padding:6px 10px; border-radius:999px; border:1px solid rgba(63,140,106,.28);
}
.ac-body{ display:grid; grid-template-columns: repeat(3,1fr); gap:8px; }

.metric{ background:var(--surface-2); border:1px solid var(--line); border-radius:12px; padding:8px 10px; }
.metric-label{ color:var(--muted); font-size:12px; }
.metric-value{ display:block; margin-top:2px; font-weight:700; }

/* -------------------- Journal list -------------------- */
.list{ display:flex; flex-direction:column; gap:10px; }
.list .row{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  background:var(--surface-2); border:1px solid var(--line); border-radius:12px; padding:10px 12px;
  text-decoration:none; color:inherit; box-shadow: 0 6px 16px rgba(0,0,0,.06);
}
.row .left{ display:flex; align-items:center; gap:10px; }
.row .icon{ width:28px; height:28px; border-radius:8px; display:grid; place-items:center; background:#FFFFFF; border:1px solid var(--line); }
.row .meta{ color:var(--muted); font-size:12px; }

/* -------------------- Gauge & Avatar -------------------- */
.gauge{
  width:140px; height:140px; border-radius:999px; position:relative;
  background:
    conic-gradient(var(--rockso-pink) 0 calc(var(--p,75%) * .40),
                   var(--rockso-orange) calc(var(--p,75%) * .40) calc(var(--p,75%) * .75),
                   var(--rockso-green)  calc(var(--p,75%) * .75) var(--p,75%),
                   #EAE3D6 var(--p,75%) 100%);
  display:grid; place-items:center;
}
.gauge::after{ content:""; position:absolute; inset:8px; background:var(--surface); border-radius:999px; border:1px solid var(--line); }
.gauge .val{ position:relative; font-size:24px; font-weight:800; color:#1c3b2f; }

.avatar{
  width:140px; height:140px; border-radius:999px; overflow:hidden;
  border:1px solid var(--line); background: var(--surface-2);
  box-shadow: 0 2px 6px rgba(0,0,0,.04) inset;
}
.avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

.grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
.badge.outline{ background:transparent; color:var(--brand-2); border:1px solid rgba(63,140,106,.45); }

/* -------------------- Tabbar iOS (frosted) -------------------- */
.tabbar{
  position:absolute; left:0; right:0; bottom:0;
  display:flex; gap:10px;
  padding:8px 12px calc(10px + env(safe-area-inset-bottom));
  height:var(--tabbar-h);

  background: rgba(255,255,255,.30);
  -webkit-backdrop-filter: saturate(240%) brightness(1.08) contrast(0.95) blur(34px);
  backdrop-filter: saturate(240%) brightness(1.08) contrast(0.95) blur(34px);

  border-top:1px solid rgba(231,222,207,.92);
  box-shadow: 0 -1px 0 rgba(255,255,255,.28) inset, 0 -10px 24px rgba(0,0,0,.06);
  z-index:10; isolation:isolate;
}
.tabbar::before{
  content:""; position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(150% 110% at 50% 0, rgba(255,255,255,.10), rgba(255,255,255,0) 60%);
  mix-blend-mode: screen; z-index:0;
}

.tab, .tab:link, .tab:visited{
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
  border:0; background:transparent; border-radius:12px;
  text-decoration:none; color:#6b7d74;
  position:relative; z-index:1; -webkit-tap-highlight-color: transparent;
}
.tab svg{ width:22px; height:22px; display:block; fill: currentColor; } /* icônes “plein” pilotées par la couleur */
.tab span{ font-weight:600 }

.tab.active, .tab.active:link, .tab.active:visited{
  color: var(--text);
  font-weight:800;
}

/* Fallback si blur non supporté */
@supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){
  .tabbar{ background: rgba(255,255,255,.85); }
}

/* -------------------- Micro-interactions -------------------- */
* { transition: color .15s ease, background-color .15s ease, border-color .15s ease; }
.btn, .tab, .chip, .activity-card, .metric, .quick-card {
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.btn:hover, .activity-card:hover, .chip:hover, .metric:hover, .quick-card:hover { transform: translateY(-1px); }
.btn:active, .activity-card:active, .chip:active, .metric:active, .quick-card:active { transform: translateY(0); }
.tab:hover { opacity:.95; }
.tab:active { transform: translateY(1px); }

/* -------------------- Backdrop hors téléphone (mode sombre + nuances) -------------------- */
.viewport{ position: relative; }
body{ background: #0b0e12; }
.theme-rockso .viewport{
  background:
    radial-gradient(900px 520px at 0% 0%,    rgba(235,110,154,.18), transparent 60%),
    radial-gradient(900px 520px at 100% 0%,  rgba(242,166,90,.16),  transparent 60%),
    radial-gradient(1100px 700px at 50% 120%,rgba(0,179,122,.20),   transparent 60%),
    linear-gradient(180deg,#11151a,#0b0e12);
}
.theme-rockso .viewport::after{
  content:""; pointer-events:none; position:absolute; inset:0;
  background:
    radial-gradient(60% 25% at 50% 95%, rgba(0,0,0,.35), transparent 60%),
    radial-gradient(50% 18% at 50% 98%, rgba(0,179,122,.14), transparent 65%);
}

/* ==================== PAGES — SYNC ==================== */
.sync-hero{
  display:grid; place-items:center;
  padding: 12px;
  background: linear-gradient(180deg,#FFFDF8,#F6F0E6);
}
.watch{ display:grid; place-items:center; }
.watch-svg{
  width: 240px; height:auto;
  filter: drop-shadow(0 10px 24px rgba(0,0,0,.12));
}
/* Annneau de progression dans le rose du thème */
.watch-svg #sync-progress-bar{ stroke: var(--rockso-pink); }

.sync-panel{ margin-top:12px; }
.sync-rows{ display:flex; flex-direction:column; gap:8px; }
.sync-row{
  display:grid; grid-template-columns: 22px 1fr auto; align-items:center;
  gap:10px; padding:8px 10px; border:1px solid var(--line); border-radius:12px;
  background:#FFFDF8;
}
.sync-ico{ color: var(--muted); display:grid; place-items:center; }
.sync-label{ color: var(--muted); font-size:14px; }
.sync-val{ font-weight:800; color: var(--text); }
.sync-actions{ display:flex; justify-content:flex-start; margin-top:10px; gap:8px; }
.sync-actions .btn[disabled]{ filter:saturate(.85) opacity(.7); cursor:not-allowed; }

/* Zone sortie sous les boutons (progress text, engrenages, message fin) */
.sync-output .muted { font-size: 13px; }

/* Pulsar centré (point + 3 ondes concentriques) — déclenché quand JS ajoute .animate */
#sync-pulsar .p-dot, #sync-pulsar .p-ring{ opacity:0; }
#sync-pulsar.animate .p-dot{ animation: pulsar-dot 2.4s ease-out infinite; }
#sync-pulsar.animate .p1{    animation: pulsar-ring 2.4s ease-out infinite .60s; }
#sync-pulsar.animate .p2{    animation: pulsar-ring 2.4s ease-out infinite 1.20s; }
#sync-pulsar.animate .p3{    animation: pulsar-ring 2.4s ease-out infinite 1.80s; }

@keyframes pulsar-dot{
  0%{ opacity:1 } 25%{ opacity:.75 } 40%{ opacity:0 } 100%{ opacity:0 }
}
@keyframes pulsar-ring{
  0%{ opacity:0; stroke-width:3 }
  10%{ opacity:1; stroke-width:3 }
  55%{ opacity:.45; stroke-width:2.6 }
  80%{ opacity:0;   stroke-width:2.3 }
  100%{opacity:0;   stroke-width:2.3 }
}

/* ==================== Barres & échelles ==================== */
.bar{ height:10px; border-radius:999px; background:var(--line); position:relative; overflow:hidden; }
.bar::after{ content:""; position:absolute; inset:0; border-radius:inherit; transform-origin:left center; }
.bar--z5::after{ background:#D32F2F; }
.bar--z4::after{ background:#F57C00; }
.bar--z3::after{ background:#F2C14E; }
.bar--z2::after{ background:#00B37A; }
.bar--z1::after{ background:#72A88A; }
.bar--recovery::after{ background:#00B37A; }
.bar--tsb::after{ background:#72A88A; }
.bar--rpe::after{ background:#F2A65A; }

.cbar{ fill:#E7DECF; }
.cbar.z1{ fill:#F2E9DA; }
.cbar.z2{ fill:#CDE8DD; }
.cbar.z3{ fill:#F9DEB7; }
.cbar.z4{ fill:#B6D7C5; }

.bar-scale{
  position:relative; height:14px; margin:10px 0 4px; background:var(--line); border-radius:999px;
}
.bar-scale .tick{ position:absolute; top:0; bottom:0; width:20%; }
.bar-scale .tick:nth-child(1){ left:0 }
.bar-scale .tick:nth-child(2){ left:20% }
.bar-scale .tick:nth-child(3){ left:40% }
.bar-scale .tick:nth-child(4){ left:60% }
.bar-scale .tick:nth-child(5){ left:80% }
.bar-scale .tick--neg{ background:linear-gradient(90deg,#E57373,transparent) }
.bar-scale .tick--pos{ background:linear-gradient(90deg,transparent,#66BB6A) }
.bar-scale .needle{
  position:absolute; top:-3px; width:2px; height:20px; background:#3F8C6A; border-radius:2px;
}

/* ==================== Training — 4 onglets ==================== */
.train-tabs{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap:6px;
  margin:8px 12px 10px;
}
.train-tabs .pill{
  min-width:0; padding:6px 8px;
  border-radius:999px; border:1px solid var(--line);
  background:#FFFDF8; color:var(--muted);
  text-decoration:none; text-align:center;
  font-weight:700; font-size:12px; line-height:1.05;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.train-tabs .pill.active{
  color:var(--text);
  border-color:rgba(63,140,106,.35);
  box-shadow:0 2px 10px rgba(63,140,106,.10);
}

/* -------------------- Media queries -------------------- */
@media (max-width:380px){
  .train-tabs .pill{ font-size:11px; padding:5px 7px; }
}

/* Journal des activités — version texte seul (pas de boîte) */
.journal-btn,
.journal-btn:link,
.journal-btn:visited{
  display: block;
  text-align: center;
  margin-top: 10px;
  padding: 0;
  background: transparent;
  border: 0;
  box-shadow: none;
  color: var(--text) !important;
  font-weight: 800;
  text-decoration: none !important;
}
.journal-btn:hover{ text-decoration: underline; opacity: .95; }
.journal-btn:focus-visible{
  outline: 2px solid rgba(63,140,106,.35);
  outline-offset: 2px;
}

/* ===== ROCKSO DEMO MIN ADD-ONS ===== */

/* Utilisé pour cacher/afficher des zones (ex: engrenage) */
.hidden { display: none !important; }

/* Badge verts/rouges pour l'analyse IA */
.badge-green{
  background: #E7F8EE;
  color: #0F8A3B;
  border: 1px solid rgba(15,138,59,.25);
}
.badge-red{
  background: #FDE8E8;
  color: #C62828;
  border: 1px solid rgba(198,40,40,.25);
}

/* Titres/corps de carte utilisés dans #analysis-panel */
.card-title{ font-weight:700; margin-bottom:8px; }
.card-body{ line-height:1.5; }

/* --- Nouvelle animation "3 engrenages" pour #ia-gear --- */
.gears { display:flex; align-items:center; gap:8px; color: var(--brand); padding:8px 0; }
.gear  { display:block; opacity:.95; }
.g-lg  { animation: spin-cw 2.2s linear infinite; }
.g-md  { animation: spin-ccw 1.8s linear infinite; margin-left:-6px; }
.g-sm  { animation: spin-cw 1.6s linear infinite;  margin-left:-6px; }
@keyframes spin-cw  { from{ transform: rotate(0turn) } to{ transform: rotate(1turn) } }
@keyframes spin-ccw { from{ transform: rotate(0turn) } to{ transform: rotate(-1turn) } }

/* Légère réduction de taille du texte de progression (sous boutons) */
.sync-output .muted { font-size: 13px; }

/* ===== Analyse de la semaine (Apple-like) ===== */
.anx{ padding:14px 12px }
.anx-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px }
.anx-head .left{ display:flex; align-items:center; gap:8px; min-width:0 }
.anx-date{ font-size:12px }

.anx .pill{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
  border:1px solid var(--line); background:#FFFDF8; color:#1c3b2f;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}
.pill--green{ background:#E7F8EE; color:#0F8A3B; border-color:rgba(15,138,59,.25) }
.pill--red{   background:#FDE8E8; color:#C62828; border-color:rgba(198,40,40,.25) }

.anx-proba{ font-size:12px; color:var(--muted) }

.anx-kpis{
  display:grid; grid-template-columns: repeat(3,1fr);
  gap:8px; margin:8px 0;
}
.anx-kpi{
  background:#FFFDF8; border:1px solid var(--line);
  border-radius:12px; padding:8px 10px; box-shadow:0 4px 12px rgba(0,0,0,.04);
}
.anx-kpi .lbl{ font-size:11px; color:var(--muted) }
.anx-kpi .val{ margin-top:2px; font-size:15px; font-weight:800; color:#1c3b2f }
.anx-kpi .sub{ margin-left:6px; font-weight:700; font-size:12px; color:var(--muted) }
.anx-kpi .sub.pos{ color:#0F8A3B }
.anx-kpi .sub.neg{ color:#C65353 }

.anx-sep{
  border:0; height:1px; background:linear-gradient(90deg, transparent, rgba(0,0,0,.06), transparent);
  margin:10px 0 8px;
}

/* Mise en forme du texte d’analyse (celui que tu écris dans analysis_text) */
.anx-body{ line-height:1.55 }
.anx-body strong{ font-weight:800 }
.anx-body ul{ margin:6px 0 8px; padding:0; list-style:none }
.anx-body li{ position:relative; padding-left:14px; margin:6px 0 }
.anx-body li::before{
  content:""; position:absolute; left:0; top:.7em;
  width:6px; height:6px; border-radius:50%;
  background: var(--brand); box-shadow:0 0 0 4px rgba(63,140,106,.14);
}
.anx-body small.muted{ display:block; margin-top:6px }

/* ===== Analyse — carrousel Apple-like =================================== */
.analysis-carousel{
  position: relative;
  overflow: hidden;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35));
  border: 1px solid rgba(231,222,207,.85);
  box-shadow: 0 10px 24px rgba(0,0,0,.06);
  backdrop-filter: saturate(180%) blur(14px);
  -webkit-backdrop-filter: saturate(180%) blur(14px);
  padding: 10px 10px 14px;
}

.analysis-carousel .ac-track{
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: 100%;
  gap: 14px;
  transform: translateX(calc(var(--i,0) * -100%));
  transition: transform .45s cubic-bezier(.2,.7,.2,1);
  will-change: transform;
}
.analysis-carousel .ac-track::after{ content:""; width:6px; } /* marge en fin pour “peeking” visuel */

.analysis-carousel .ac-slide{
  position: relative;
  background: var(--surface-2);
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 12px;
  box-shadow: 0 8px 22px rgba(0,0,0,.07);
}
.analysis-carousel .ac-slide::before{
  /* léger motif / halo */
  content:""; position:absolute; inset:-1px;
  background:
    radial-gradient(420px 200px at 80% -10%, rgba(232,205,175,.18), transparent 55%),
    radial-gradient(320px 220px at -10% 120%, rgba(179,228,206,.20), transparent 60%);
  border-radius: inherit; pointer-events: none;
}
.analysis-carousel .ac-head{
  display:flex; align-items:center; gap:8px; margin-bottom:8px;
}
.analysis-carousel .ac-head .accent{ font-size:18px; }
.analysis-carousel .ac-head h3{
  margin:0; font-size:14px; text-transform:uppercase; letter-spacing:.12em; color:var(--text); opacity:.9;
}

/* contenu */
.analysis-carousel .ac-body{ font-size:14px; line-height:1.45; }
.ac-metrics{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; }
.ac-metrics.three{ grid-template-columns: repeat(3, minmax(0,1fr)); }
.ac-metrics .m{
  background:#FFFDF8; border:1px solid var(--line); border-radius:12px; padding:8px;
}
.ac-metrics .k{ display:block; color:var(--muted); font-size:12px; }
.ac-metrics strong{ display:block; font-size:16px; color:#1c3b2f; }
.ac-metrics .s{ display:block; margin-top:2px; font-size:12px; color:var(--muted); }

.ac-bars .b{ margin:8px 0; position:relative; }
.ac-bars .k{ display:block; font-size:12px; color:var(--muted); margin-bottom:2px; }
.ac-bars .bar{ height:10px; background:rgba(0,0,0,.06); border-radius:999px; overflow:hidden; }
.ac-bars .bar .fill{ height:100%; background: var(--brand-2); }
.ac-bars .delta{ position:absolute; right:0; top:-2px; font-size:12px; color:var(--muted) }
.ac-bars .delta.up{ color:#0F8A3B }
.ac-bars .delta.down{ color:#C62828 }

.pill{
  display:inline-flex; align-items:center; gap:6px; margin-top:8px;
  padding:6px 10px; border-radius:999px; font-weight:700; border:1px solid transparent;
}
.pill-green{ background:#E7F8EE; color:#0F8A3B; border-color:rgba(15,138,59,.25); }
.pill-amber{ background:#FFF4E5; color:#9A6506; border-color:rgba(242,166,90,.35); }
.pill-red{   background:#FDE8E8; color:#C62828; border-color:rgba(198,40,40,.25); }

.coach{ margin:0; padding-left:18px; }
.coach li{ margin:6px 0; }

.tip-card{
  margin-top:10px; padding:10px; border-radius:12px;
  border:1px dashed rgba(63,140,106,.35); background:#FFFBF4;
}
.tip-card.ok{ border-style:solid; border-color: rgba(63,140,106,.45) }
.tip-card .t{ font-size:12px; color:var(--muted); margin-bottom:4px }
.tip-card .b{ display:flex; gap:8px; align-items:flex-start }

/* pastilles de pagination + progress */
.ac-dots{
  display:flex; justify-content:center; gap:8px; margin-top:10px;
}
.ac-dot{
  position:relative; width:28px; height:6px; border-radius:999px;
  background: rgba(0,0,0,.12); border:0; padding:0; cursor:pointer;
}
.ac-dot .fill{
  position:absolute; left:0; top:0; bottom:0; width: calc(var(--p,0) * 100%);
  background:#fff; border-radius:inherit; box-shadow: 0 0 0 1px rgba(0,0,0,.06) inset;
}
.ac-dot.active{ background: rgba(255,255,255,.35); }

/* légère impression de drag */
.analysis-carousel .ac-track{ transform: translateX(calc(var(--i,0) * -100%)) translateX(calc(var(--drag, 0px) * -1)); }

/* === Coach card compact ================================================ */
.coach-tiles{
  display:grid; grid-template-columns: repeat(3,1fr); gap:8px;
}
.tile{
  background:#FFFDF8; border:1px solid var(--line);
  border-radius:12px; padding:8px;
  box-shadow: 0 4px 12px rgba(0,0,0,.05);
}
.tile .t{ font-size:11px; color:var(--muted); }
.tile .v{ font-weight:800; margin-top:2px; color:#1c3b2f; }
.tile .hint{ margin:2px 0 0; font-size:12px; color:var(--muted); }

/* Détails repliés (évite le gros pavé) */
.coach-details{ margin-top:6px; }
.coach-details summary{
  cursor:pointer; list-style:none; padding:6px 0;
  font-weight:700; font-size:13px; color:#1c3b2f;
}
.coach-details summary::-webkit-details-marker{ display:none; }

/* Clamp du texte pour garantir une hauteur homogène */
/* Clamp du texte pour garantir une hauteur homogène */
.tip-card .b{
  display: -webkit-box;          /* legacy WebKit */
  -webkit-box-orient: vertical;  /* legacy WebKit */
  -webkit-line-clamp: 3;         /* legacy WebKit */
  line-clamp: 3;                 /* propriété standard */
  overflow: hidden;
}

/* Petite ligne d’info (sommeil/HRV) */
.micro-hint{ margin-top:6px; font-size:12px; color:var(--muted); }

/* ================== ROCKSO — ANALYSE (carousel Apple-like) ================== */
:root{
  --story-peek: 14px;          /* “morceaux” visibles à droite/gauche */
  --story-h: 260px;            /* hauteur uniforme des cartes */
  --story-pad: 14px;           /* padding interne des cartes */
}

/* Stage = conteneur scrollable */
.story-stage{
  position: relative;
  overflow-x: auto;
  overflow-y: visible;
  scroll-snap-type: x mandatory;
  scroll-padding-left: var(--story-peek);
  scroll-padding-right: var(--story-peek);
  padding: 0 var(--story-peek);
  display: flex;
  gap: 12px;
  -webkit-overflow-scrolling: touch;
  mask-image: linear-gradient(to right,
      transparent 0, black 16px,
      black calc(100% - 16px), transparent 100%); /* bords doux façon Apple */
}

/* Chaque slide occupe la largeur utile – les “peek” restent visibles */
.story-card{
  flex: 0 0 calc(100% - var(--story-peek)*2);
  min-height: var(--story-h);
  background: var(--surface-2);
  border: 1px solid var(--line);
  border-radius: 18px;
  box-shadow: 0 8px 22px rgba(0,0,0,.06);
  padding: var(--story-pad);
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* titre en haut, contenu centre, footer en bas */
}

/* Titre de carte */
.story-title{
  font-weight: 800;
  letter-spacing: .08em;
  text-transform: uppercase;
  font-size: 13px;
  color: var(--text);
  opacity: .9;
  margin: 2px 0 8px;
}

/* Ligne de chips (5 chiffres, etc.) – grille stable */
.story-grid{
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}
.story-chip{
  background: #fffdf8;
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 10px;
  display: grid;
  grid-template-rows: auto 1fr;
}
.story-chip .lbl{ font-size: 12px; color: var(--muted); }
.story-chip .val{ font-weight: 800; font-size: 18px; color:#1c3b2f; }

/* Barre double (charge/intensité) */
.story-bars{ display:grid; gap:8px; margin-top:4px; }
.story-bar{ height:10px; border-radius:999px; background: var(--line); position:relative; overflow:hidden; }
.story-bar .fill{ position:absolute; inset:0; transform-origin:left center; }
.story-bar.vol .fill{ background: var(--brand); }
.story-bar.int .fill{ background: var(--rockso-orange); }

/* Bulle (feedback visuel) */
.story-bubble{
  align-self: center;
  background: rgba(0,179,122,.12);
  border: 1px solid rgba(0,179,122,.28);
  color: #1c3b2f;
  border-radius: 999px;
  padding: 14px 16px;
  font-weight: 800;
  text-align: center;
}

/* Multiline clamp (warning-free) */
.clamp-2,
.clamp-3{
  display: -webkit-box;          /* needed for WebKit clamp */
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Put the standard prop first, then the vendor prop */
.clamp-2{ line-clamp: 2; -webkit-line-clamp: 2; }
.clamp-3{ line-clamp: 3; -webkit-line-clamp: 3; }

/* Optional non-WebKit fallback (keeps layout tidy even without clamp) */
@supports not (-webkit-line-clamp: 2){
  .clamp-2{ display:block; line-height:1.3; max-height: calc(1.3em * 2); }
  .clamp-3{ display:block; line-height:1.3; max-height: calc(1.3em * 3); }
}

/* Pagination “ovale qui se remplit” */
.story-dots{
  display:flex; justify-content:center; gap:10px; margin-top:10px;
}
.story-dot{
  position:relative; width:26px; height:6px; border-radius:999px;
  background: rgba(0,0,0,.08);
  overflow:hidden;
}
.story-dot::after{
  content:""; position:absolute; left:0; top:0; bottom:0; width:0%;
  background: #fff; border-radius:inherit;
}
/* Animation de remplissage (activée par JS) */
.story-stage.is-autoplay .story-dot.active::after{
  animation: dotfill var(--autoplay-sec,10s) linear forwards;
}
.story-stage.is-paused .story-dot.active::after{
  animation-play-state: paused;
}
@keyframes dotfill{ from{ width:0% } to{ width:100% } }
